#!/usr/bin/env ruby

ROOT_DIR = File.join(File.dirname(__FILE__), '..')

Dir.chdir ROOT_DIR do
  require 'bundler/setup'
end

$LOAD_PATH.unshift(File.join(ROOT_DIR, 'lib'))

require 'cli'
require 'generate'

options = {}
parser = Cli::make_option_parser(options)

parser.parse!(ARGV)
options[:template] = ARGV.last

begin
  Cli::check_opts(options)
rescue ArgConflictError => e
  STDERR.puts("invalid arguments: #{e}")
  exit(1)
rescue ArgMissingError => e
  STDERR.puts("missing argument: #{e}")
  exit(1)
end

Generate::generate(
  options[:template],
  input: options[:input],
  output: options[:output],
  context: options[:context]
)
